---
import Layout from "../layouts/Layout.astro";
import { actions } from "astro:actions";
import { TheList } from "@components/Tables/TheList";

const auth = Astro.locals.auth();
const clerkId = auth?.userId;

const { data: isAdmin } = auth.userId
  ? await Astro.callAction(actions.viewers.checkAdmin, {
      clerkId: auth?.userId ?? "",
    })
  : { data: false };

const result = await Astro.callAction(actions.util.getTheList, {
  currentUserId: clerkId ?? undefined,
});
---

<Layout title="The List">
  <TheList
    client:only="react"
    tableData={result?.data?.tableData ?? []}
    isCurrentViewer={!!auth?.userId}
    isAdmin={isAdmin ?? false}
  />
</Layout>
